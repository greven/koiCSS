// --------------------------------
//   Output Helpers
// --------------------------------

@use 'sass:meta';
@use 'sass:string';

@use '../config' as *;
@use '../helpers/string' as *;
@use 'color' as *;

// --------------------------------
//   Functions
// --------------------------------

// Return the prefix of the css vars if configured
@function _css-var-prefix($prefix: config(prefix)) {
  $prefix: if($prefix == '', '', '#{$prefix}-');
  @return $prefix;
}

// Returns the css custom property
@function -css-var-name($name, $key: null, $suffix: null) {
  $prefix: _css-var-prefix();
  $suffix: if($suffix, '-#{$suffix}', '');
  $key: if($name and $key, '-#{$key}', $key);

  @return '--#{$prefix}#{$name}#{$key}#{$suffix}';
}

// A wrapper for var() that prefixes the custom property name if configured.
// Example: css-var(--c-green-5) -> var(--koi-c-green-5)
@function css-var($name, $fallback: null) {
  $name: replace($name, '--', '');
  $var-name: string.unquote(-css-var-name($name));
  @if $fallback {
    @return var($var-name, $fallback);
  }
  @return var($var-name);
}

// --------------------------------
//   Mixins
// --------------------------------

// Output a CSS custom property (CSS var) definition
@mixin custom-prop($property, $key, $value) {
  $value: if(meta.type-of($value) == 'string', string.unquote($value), $value);
  #{-css-var-name($property, $key)}: $value;
}

// Output a CSS custom property (CSS var) color definition
@mixin color-custom-prop($property, $color-name: null, $value, $suffix: null) {
  @if meta.type-of($value) == 'color' {
    $var-name: #{-css-var-name($property, $color-name, $suffix)};
    @include hsl-color-custom-prop($var-name, $value);
  } @else {
    @each $shade, $shade-value in $value {
      $key: if($color-name and $shade, '#{$color-name}-#{$shade}', $shade);
      $var-name: #{-css-var-name($property, $key, $suffix)};
      @include hsl-color-custom-prop($var-name, $shade-value);
    }
  }
}
