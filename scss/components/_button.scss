// --------------------------------
//   Button Components
// --------------------------------

@use 'sass:selector';

@use '../config';
@use '../api' as *;

// --------------------------------
//   Vars
// --------------------------------

$class: '.btn';

$selectors: selector.parse(
  "#{$class}, a#{$class}, [type='button']#{$class}, [type='submit']#{$class}, [type='reset']#{$class}"
);

// Defaults
$height: 40px;
$height-compact: 30px;

$font-size: font(md);
$leading: text-leading(md);
$tracking: tracking(wide);

$border-radius: radius(lg);
$border-width: 2px;

$padding-x: 18px;
$padding-x-compact: 10px;
$padding-x-wide: spacing(80);

$shadow: shadow(xs);

// --------------------------------
//   Mixins
// --------------------------------

@mixin pseudo($pseudo) {
  &#{$pseudo}:not(:disabled, [data-state='disabled']) {
    @content;
  }
}

@mixin hover {
  @include pseudo(':hover') {
    @content;
  }
}

@mixin focus {
  @include pseudo(':focus') {
    @content;
  }
}

@mixin active {
  @include pseudo(':active') {
    @content;
  }
}

@mixin disabled {
  &:disabled,
  &[data-state='disabled'] {
    @content;
  }
}

// Button focus mixin to had a focus ring
@mixin focus-ring($color: fill(cnt, 9), $width: 2px, $offset-color: fill(srf, 1), $offset: 2px) {
  &:focus-visible {
    @include ring($color: $color, $width: $width, $offset-color: $offset-color, $offset: $offset);
  }
}

// Color variant selector
@mixin color-variant($color) {
  &#{$class}--#{$color} {
    @content;
  }
}

@mixin reset {
  appearance: none;
  background-color: transparent;
  border: 0;
  cursor: pointer;
  font-weight: 400;
  padding: 0;
  text-decoration: none;
  touch-action: manipulation;
  user-select: none;
  white-space: nowrap;

  &:focus {
    outline: none;
  }
}

@mixin default {
  @include focus-ring;
  @include transition((color, background-color, border-color, transform));

  align-items: var(--koi-btn-align-items, center);
  background-color: var(--koi-btn-background, fill(srf, 1));
  border-color: var(--koi-btn-border-color, fill(brd, 1));
  border-radius: var(--koi-btn-border-radius, $border-radius);
  border-style: var(--koi-btn-border-style, solid);
  border-width: var(--koi-btn-border-width, 1px);
  box-shadow: var(--koi-btn-shadow, $shadow);
  color: var(--koi-btn-foreground, fill(txt, 1));
  display: var(--koi-btn-display, inline-flex);
  font-size: var(--koi-btn-font-size, $font-size);
  font-weight: var(--koi-btn-font-weight, font(semibold));
  gap: var(--koi-btn-gap, 1ch);
  height: var(--koi-btn-height, $height);
  justify-content: var(--koi-btn-justify-content, center);
  letter-spacing: var(--koi-btn-tracking, $tracking);
  line-height: var(--koi-btn-leading, $leading);
  padding: 0 var(--koi-btn-padding-x, $padding-x);
  text-align: var(--koi-btn-text-align, center);
  text-transform: var(--koi-btn-text-transform, capitalize);

  @include hover {
    @include shadow(var(--koi-btn-shadow-hover, $shadow));

    background-color: var(--koi-btn-background-hover, fill(srf, 2));
    color: var(--koi-btn-foreground-hover, fill(txt, 1));
  }

  @include active {
    @include shadow(var(--koi-btn-shadow-hover, shadow(none)));

    @if config.$use-button-animation {
      transform: translateY(var(--koi-btn-animation-scale, 1px));
    } @else {
      background-color: var(--koi-btn-background-active, fill(srf, 1));
      color: var(--koi-btn-foreground-active, fill(txt, 1));
    }
  }

  @include disabled {
    background-color: var(--koi-btn-background-disabled, fill(srf, 3, $alpha: 0.4));
    border-color: var(--koi-btn-border-color-disabled, transparent);
    box-shadow: none;
    color: var(--koi-btn-foreground-disabled, fill(txt, 3));
    cursor: not-allowed;
  }

  @include color-variant(inverted) {
    --koi-btn-background: #{fill(cnt, 9)};
    --koi-btn-background-hover: #{fill(cnt, 7)};
    --koi-btn-background-active: #{fill(cnt, 9)};
    --koi-btn-border-color: transparent;
    --koi-btn-foreground: #{fill(cnt, 0)};
    --koi-btn-foreground-hover: #{fill(cnt, 1)};
    --koi-btn-foreground-active: #{fill(cnt, 0)};
  }
}

// ---- Variants ----

@mixin solid {
  --koi-btn-background: #{fill(cnt, 9)};
  --koi-btn-background-hover: #{fill(cnt, 7)};
  --koi-btn-background-active: #{fill(cnt, 9)};
  --koi-btn-border-color: transparent;
  --koi-btn-foreground: #{fill(cnt, 0)};
  --koi-btn-foreground-hover: #{fill(cnt, 1)};
  --koi-btn-foreground-active: #{fill(cnt, 0)};
  --koi-btn-shadow: #{shadow(sm)};

  @include focus-ring(fill(cnt, 9));

  border-width: var(--koi-btn-border-width, $border-width);

  // Color variants
  @include color-variant(accent) {
    --koi-btn-background: #{accent(6)};
    --koi-btn-background-hover: #{accent(7)};
    --koi-btn-background-active: #{accent(6)};
    --koi-btn-foreground: #{fill(white)};
    --koi-btn-foreground-hover: #{fill(white)};
    --koi-btn-foreground-active: #{fill(white)};

    @include focus-ring(accent(6));
  }

  @each $color in config.$enabled-color-variants {
    @include color-variant($color) {
      --koi-btn-background: #{fill($color, 6)};
      --koi-btn-background-hover: #{fill($color, 7)};
      --koi-btn-background-active: #{fill($color, 6)};
      --koi-btn-foreground: #{fill(white)};
      --koi-btn-foreground-hover: #{fill(white)};
      --koi-btn-foreground-active: #{fill(white)};

      @include focus-ring(fill($color, 6));
    }
  }
}

@mixin outline {
  --koi-btn-background: transparent;
  --koi-btn-background-hover: #{fill(cnt, 1)};
  --koi-btn-background-active: transparent;
  --koi-btn-border-color: #{fill(cnt, 9)};
  --koi-btn-border-color-hover: #{fill(cnt, 7)};
  --koi-btn-foreground: #{fill(cnt, 9)};
  --koi-btn-foreground-hover: #{fill(cnt, 7)};
  --koi-btn-foreground-active: #{fill(cnt, 9)};

  @include shadow(var(--koi-btn-shadow-hover, shadow(none)));
  @include focus-ring(fill(cnt, 9));

  border-width: var(--koi-btn-border-width, $border-width);

  @include hover {
    @include shadow(var(--koi-btn-shadow-hover, shadow(none)));
  }

  @include dark-mode {
    --koi-btn-background-hover: #{fill(cnt, 2)};
    --koi-btn-background-active: #{fill(cnt, 1)};
  }

  // Color variants
  @include color-variant(accent) {
    --koi-btn-background-hover: #{accent(0)};
    --koi-btn-background-active: transparent;
    --koi-btn-border-color: #{accent(6)};
    --koi-btn-border-color-hover: #{accent(9)};
    --koi-btn-foreground: #{accent(6)};
    --koi-btn-foreground-hover: #{accent(9)};
    --koi-btn-foreground-active: #{accent(6)};

    @include focus-ring(accent(6));

    @include dark-mode {
      --koi-btn-background-hover: #{accent(8, $alpha: 0.2)};
      --koi-btn-background-active: transparent;
      --koi-btn-border-color: #{accent(5)};
      --koi-btn-border-color-hover: #{accent(4)};
      --koi-btn-foreground: #{accent(5)};
      --koi-btn-foreground-hover: #{accent(4)};
      --koi-btn-foreground-active: #{accent(5)};

      @include focus-ring(accent(5));
    }
  }

  @each $color in config.$enabled-color-variants {
    @include color-variant($color) {
      --koi-btn-background-hover: #{fill($color, 0)};
      --koi-btn-background-active: transparent;
      --koi-btn-border-color: #{fill($color, 6)};
      --koi-btn-border-color-hover: #{fill($color, 8)};
      --koi-btn-foreground: #{fill($color, 6)};
      --koi-btn-foreground-hover: #{fill($color, 8)};
      --koi-btn-foreground-active: #{fill($color, 6)};

      @include focus-ring(fill($color, 6));

      @include dark-mode {
        --koi-btn-background-hover: #{fill($color, 8, $alpha: 0.2)};
        --koi-btn-background-active: transparent;
        --koi-btn-border-color: #{fill($color, 5)};
        --koi-btn-border-color-hover: #{fill($color, 4)};
        --koi-btn-foreground: #{fill($color, 5)};
        --koi-btn-foreground-hover: #{fill($color, 4)};
        --koi-btn-foreground-active: #{fill($color, 5)};

        @include focus-ring(fill($color, 5));
      }
    }
  }
}

@mixin faded {
  --koi-btn-background: #{fill(cnt, 1)};
  --koi-btn-background-hover: #{fill(cnt, 2)};
  --koi-btn-background-active: #{fill(cnt, 1)};
  --koi-btn-border-color: transparent;
  --koi-btn-border-color-hover: transparent;
  --koi-btn-foreground: #{fill(cnt, 8)};
  --koi-btn-foreground-hover: #{fill(cnt, 9)};
  --koi-btn-foreground-active: #{fill(cnt, 8)};

  @include shadow(var(--koi-btn-shadow-hover, shadow(none)));
  @include focus-ring(fill(cnt, 9));

  border-width: var(--koi-btn-border-width, $border-width);

  @include hover {
    @include shadow(var(--koi-btn-shadow-hover, shadow(none)));
  }

  @include dark-mode {
    --koi-btn-background: #{fill(cnt, 2)};
    --koi-btn-background-hover: #{fill(cnt, 3, $alpha: 0.5)};
    --koi-btn-background-active: #{fill(cnt, 2, $alpha: 0.5)};
  }

  // Color variants
  @include color-variant(accent) {
    --koi-btn-background: #{accent(1)};
    --koi-btn-background-hover: #{accent(2)};
    --koi-btn-background-active: #{accent(1)};
    --koi-btn-foreground: #{accent(8)};
    --koi-btn-foreground-hover: #{accent(9)};
    --koi-btn-foreground-active: #{accent(8)};

    @include focus-ring(accent(6));

    @include dark-mode {
      --koi-btn-background: #{accent(8, $alpha: 0.2)};
      --koi-btn-background-hover: #{accent(7, $alpha: 0.2)};
      --koi-btn-background-active: #{accent(8, $alpha: 0.2)};
      --koi-btn-foreground: #{accent(5)};
      --koi-btn-foreground-hover: #{accent(4)};
      --koi-btn-foreground-active: #{accent(5)};
    }
  }

  @each $color in config.$enabled-color-variants {
    @include color-variant($color) {
      --koi-btn-background: #{fill($color, 1)};
      --koi-btn-background-hover: #{fill($color, 2)};
      --koi-btn-background-active: #{fill($color, 1)};
      --koi-btn-foreground: #{fill($color, 8)};
      --koi-btn-foreground-hover: #{fill($color, 9)};
      --koi-btn-foreground-active: #{fill($color, 8)};

      @include focus-ring(fill($color, 6));

      @include dark-mode {
        --koi-btn-background: #{fill($color, 8, $alpha: 0.2)};
        --koi-btn-background-hover: #{fill($color, 7, $alpha: 0.2)};
        --koi-btn-background-active: #{fill($color, 8, $alpha: 0.2)};
        --koi-btn-foreground: #{fill($color, 5)};
        --koi-btn-foreground-hover: #{fill($color, 4)};
        --koi-btn-foreground-active: #{fill($color, 5)};
      }
    }
  }
}

@mixin ghost {
  --koi-btn-background: transparent;
  --koi-btn-background-hover: #{fill(cnt, 1)};
  --koi-btn-background-active: #{fill(cnt, 1, $alpha: 0.5)};
  --koi-btn-border-color: transparent;
  --koi-btn-border-color-hover: transparent;
  --koi-btn-foreground: #{fill(cnt, 8)};
  --koi-btn-foreground-hover: #{fill(cnt, 9)};
  --koi-btn-foreground-active: #{fill(cnt, 8)};

  @include shadow(var(--koi-btn-shadow-hover, shadow(none)));
  @include focus-ring(fill(cnt, 9));

  border-width: var(--koi-btn-border-width, $border-width);

  @include hover {
    @include shadow(var(--koi-btn-shadow-hover, shadow(none)));
  }

  @include dark-mode {
    --koi-btn-background-hover: #{fill(cnt, 2, $alpha: 0.75)};
    --koi-btn-background-active: #{fill(cnt, 2, $alpha: 0.5)};
  }

  // Color variants
  @include color-variant(accent) {
    --koi-btn-background-hover: #{accent(1)};
    --koi-btn-background-active: #{accent(1, $alpha: 0.5)};
    --koi-btn-foreground: #{accent(7)};
    --koi-btn-foreground-hover: #{accent(8)};
    --koi-btn-foreground-active: #{accent(7)};

    @include focus-ring(accent(6));

    @include dark-mode {
      --koi-btn-background-hover: #{accent(8, $alpha: 0.2)};
      --koi-btn-background-active: #{accent(9, $alpha: 0.2)};
      --koi-btn-foreground: #{accent(5)};
      --koi-btn-foreground-hover: #{accent(4)};
      --koi-btn-foreground-active: #{accent(5)};
    }
  }

  @each $color in config.$enabled-color-variants {
    @include color-variant($color) {
      --koi-btn-background-hover: #{fill($color, 1)};
      --koi-btn-background-active: #{fill($color, 1, $alpha: 0.5)};
      --koi-btn-foreground: #{fill($color, 7)};
      --koi-btn-foreground-hover: #{fill($color, 8)};
      --koi-btn-foreground-active: #{fill($color, 7)};

      @include focus-ring(fill($color, 6));

      @include dark-mode {
        --koi-btn-background-hover: #{fill($color, 8, $alpha: 0.2)};
        --koi-btn-background-active: #{fill($color, 9, $alpha: 0.2)};
        --koi-btn-foreground: #{fill($color, 5)};
        --koi-btn-foreground-hover: #{fill($color, 4)};
        --koi-btn-foreground-active: #{fill($color, 5)};
      }
    }
  }
}

@mixin link {
  --koi-btn-background: transparent;
  --koi-btn-background-hover: transparent;
  --koi-btn-background-active: transparent;
  --koi-btn-border-color: transparent;
  --koi-btn-border-color-hover: transparent;
  --koi-btn-foreground: #{fill(cnt, 8)};
  --koi-btn-foreground-hover: #{fill(cnt, 9)};
  --koi-btn-foreground-active: #{fill(cnt, 8)};

  @include shadow(var(--koi-btn-shadow-hover, shadow(none)));
  @include focus-ring(fill(cnt, 9));

  border-width: var(--koi-btn-border-width, $border-width);

  @include hover {
    @include shadow(var(--koi-btn-shadow-hover, shadow(none)));
    text-decoration: underline;
  }

  // Color variants
  @include color-variant(accent) {
    --koi-btn-foreground: #{accent(7)};
    --koi-btn-foreground-hover: #{accent(8)};
    --koi-btn-foreground-active: #{accent(7)};

    @include focus-ring(accent(6));

    @include dark-mode {
      --koi-btn-foreground: #{accent(5)};
      --koi-btn-foreground-hover: #{accent(4)};
      --koi-btn-foreground-active: #{accent(5)};
    }
  }

  @each $color in config.$enabled-color-variants {
    @include color-variant($color) {
      --koi-btn-foreground: #{fill($color, 7)};
      --koi-btn-foreground-hover: #{fill($color, 8)};
      --koi-btn-foreground-active: #{fill($color, 7)};

      @include focus-ring(fill($color, 6));

      @include dark-mode {
        --koi-btn-foreground: #{fill($color, 5)};
        --koi-btn-foreground-hover: #{fill($color, 4)};
        --koi-btn-foreground-active: #{fill($color, 5)};
      }
    }
  }
}

// ---- Modifiers ----

@mixin circle {
  border-radius: radius(full);
  height: var(--koi-btn-height, $height);
  padding: 0;
  width: var(--koi-btn-height, $height);

  @include color-variant(compact) {
    height: var(--koi-btn-height-compact, $height-compact);
    width: var(--koi-btn-height-compact, $height-compact);
  }
}

@mixin square {
  border-radius: var(--koi-btn-border-radius, $border-radius);
  height: var(--koi-btn-height, $height);
  padding: 0;
  width: var(--koi-btn-height, $height);

  @include color-variant(compact) {
    height: var(--koi-btn-height-compact, $height-compact);
    width: var(--koi-btn-height-compact, $height-compact);
  }
}

// Makes the button wider (more horizontal padding)
@mixin wide {
  padding: 0 var(--koi-btn-padding-x-wide, $padding-x-wide);
}

// Makes the button full width
@mixin block {
  justify-content: center;
  width: 100%;
}

@mixin compact {
  font-size: var(--koi-btn-font-size-compact, font(sm));
  height: var(--koi-btn-height-compact, $height-compact);
  line-height: var(--koi-btn-leading-compact, text-leading(sm));
  padding: 0 var(--koi-btn-padding-x-compact, $padding-x-compact);
}

@mixin icon {
  flex-shrink: 0;
  height: size(20);
  width: size(20);

  &--compact {
    height: size(16);
    width: size(16);
  }
}

@mixin group {
  display: inline-flex;
  position: relative;

  #{$selectors} {
    @include focus-ring(accent(6));

    flex: 1 0 auto;
    margin: 0;

    @include focus {
      z-index: 10;
    }

    &:first-child:not(:last-child) {
      border-bottom-right-radius: 0;
      border-top-right-radius: 0;
    }

    &:last-child:not(:first-child) {
      border-bottom-left-radius: 0;
      border-top-left-radius: 0;
      margin-left: -1px;
    }

    &:not(:first-child):not(:last-child) {
      border-radius: 0;
      margin-left: -1px;
    }
  }

  &--block {
    display: flex;

    #{$selectors} {
      flex: 1 0;
    }
  }
}

// --------------------------------
//   Styles
// --------------------------------

@mixin styles {
  button,
  [type='button'],
  [type='submit'],
  [type='reset'],
  [type='file'] {
    @include reset;
  }

  #{$selectors} {
    @include default;

    &--solid {
      @include solid;
    }

    &--outline {
      @include outline;
    }

    &--faded {
      @include faded;
    }

    &--ghost {
      @include ghost;
    }

    &--link {
      @include link;
    }

    &--wide {
      @include wide;
    }

    &--block {
      @include block;
    }

    &--compact {
      @include compact;
    }

    &--circle {
      @include circle;
    }

    &--square {
      @include square;
    }
  }

  // Button Icon
  #{$class}-icon {
    @include icon;
  }

  // Button Group
  #{$class}-group {
    @include group;
  }
}
