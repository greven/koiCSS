// --------------------------------
//   Button Components
// --------------------------------

@use 'sass:selector';

@use '../config';
@use '../api' as *;

// --------------------------------
//   Vars
// --------------------------------

$class: '.btn';

$selectors: selector.parse(
  "#{$class}, a#{$class}, [type='button']#{$class}, [type='submit']#{$class}, [type='reset']#{$class}"
);

// --------------------------------
//   Mixins
// --------------------------------

// Button focus mixin to had a focus ring
@mixin focus($color: fill(contrast, 9), $offset-color: fill(surface, 1)) {
  &:focus-visible {
    @include ring($color: $color, $offset-color: $offset-color);
  }
}

@mixin hover {
  &:hover:not(:disabled, [data-state='disabled']) {
    @content;
  }
}

@mixin active {
  &:active:not(:disabled, [data-state='disabled']) {
    @content;
  }
}

@mixin disabled {
  &:disabled,
  &[data-state='disabled'] {
    @content;
  }
}

@mixin reset {
  appearance: none;
  background-color: transparent;
  border: 0;
  cursor: pointer;
  font-weight: 400;
  padding: 0;
  text-decoration: none;
  touch-action: manipulation;
  user-select: none;
  white-space: nowrap;

  &:focus {
    outline: none;
  }
}

@mixin default {
  @include focus;
  @include transition((color, background-color, border-color, transform), duration(fast));

  align-items: var(--koi-btn-align-items, center);
  background-color: var(--koi-btn-background, fill(surface, 2));
  border-color: var(--koi-btn-border-color, fill(border, 2));
  border-radius: var(--koi-btn-border-radius, radius(lg));
  border-style: var(--koi-btn-border-style, solid);
  border-width: var(--koi-btn-border-width, 1px);
  box-shadow: var(--koi-btn-shadow, shadow(xs));
  color: var(--koi-btn-foreground, fill(text, 2));
  display: var(--koi-btn-display, inline-flex);
  font-size: var(--koi-btn-font-size, font(sm));
  font-weight: var(--koi-btn-font-weight, font(semibold));
  gap: var(--koi-btn-gap, 1ch);
  justify-content: var(--koi-btn-justify-content, center);
  letter-spacing: var(--koi-btn-tracking, tracking(wide));
  line-height: var(--koi-btn-leading, text-leading(sm));
  padding: var(--koi-btn-padding-y, 8px) var(--koi-btn-padding-x, 18px);
  text-align: var(--koi-btn-text-align, center);
  text-transform: var(--koi-btn-text-transform, capitalize);

  @include hover {
    @include shadow(var(--koi-btn-shadow-hover, shadow(sm)));

    background-color: var(--koi-btn-background-hover, fill(surface, 3));
    color: var(--koi-btn-foreground-hover, fill(text, 2));
  }

  @include active {
    @include shadow(var(--koi-btn-shadow-hover, shadow(none)));

    background-color: var(--koi-btn-background-active, fill(surface, 3));
    color: var(--koi-btn-foreground-active, fill(text, 2));

    @if config.$use-button-animation {
      transform: translateY(1px);
    }
  }

  @include disabled {
    background-color: var(--koi-btn-background-disabled, fill(surface, 4));
    border-color: var(--koi-btn-border-color-disabled, transparent);
    box-shadow: none;
    color: var(--koi-btn-foreground-disabled, fill(text, 3));
    cursor: not-allowed;
  }
}

// ---- Variants ----

@mixin variant($variant) {
  &#{$class}--#{$variant} {
    @content;
  }
}

@mixin solid {
  --koi-btn-background: #{fill(contrast, 9)};
  --koi-btn-background-hover: #{fill(contrast, 7)};
  --koi-btn-background-active: #{fill(contrast, 7)};
  --koi-btn-border-color: transparent;
  --koi-btn-foreground: #{fill(contrast, 0)};
  --koi-btn-foreground-hover: #{fill(contrast, 0)};
  --koi-btn-foreground-active: #{fill(contrast, 0)};

  @include focus(fill(contrast, 9));

  border-width: var(--koi-btn-border-width, 2px);

  // Variant colors
  @include variant(accent) {
    --koi-btn-background: #{accent(6)};
    --koi-btn-background-hover: #{accent(7)};
    --koi-btn-background-active: #{accent(7)};
    --koi-btn-foreground: #{fill(white)};
    --koi-btn-foreground-hover: #{fill(white)};
    --koi-btn-foreground-active: #{fill(white)};

    @include focus(accent(6));
  }

  @each $color in config.$variant-colors {
    @include variant($color) {
      --koi-btn-background: #{fill($color, 6)};
      --koi-btn-background-hover: #{fill($color, 7)};
      --koi-btn-background-active: #{fill($color, 7)};
      --koi-btn-foreground: #{fill(white)};
      --koi-btn-foreground-hover: #{fill(white)};
      --koi-btn-foreground-active: #{fill(white)};

      @include focus(fill($color, 6));
    }
  }
}

@mixin outline {
  --koi-btn-background: transparent;
  --koi-btn-background-hover: #{fill(contrast, 1)};
  --koi-btn-background-active: #{fill(contrast, 1)};
  --koi-btn-border-color: #{fill(contrast, 9)};
  --koi-btn-border-color-hover: #{fill(contrast, 7)};
  --koi-btn-foreground: #{fill(contrast, 9)};
  --koi-btn-foreground-hover: #{fill(contrast, 7)};
  --koi-btn-foreground-active: #{fill(contrast, 7)};

  @include shadow(var(--koi-btn-shadow-hover, shadow(none)));
  @include focus(fill(contrast, 9));

  border-width: var(--koi-btn-border-width, 2px);

  @include hover {
    @include shadow(var(--koi-btn-shadow-hover, shadow(none)));
  }

  @include dark-mode {
    --koi-btn-background-hover: #{fill(contrast, 2)};
    --koi-btn-background-active: #{fill(contrast, 2)};
  }

  // Variant colors
  @include variant(accent) {
    --koi-btn-background-hover: #{accent(0)};
    --koi-btn-background-active: #{accent(0)};
    --koi-btn-border-color: #{accent(6)};
    --koi-btn-border-color-hover: #{accent(9)};
    --koi-btn-foreground: #{accent(6)};
    --koi-btn-foreground-hover: #{accent(9)};
    --koi-btn-foreground-active: #{accent(9)};

    @include focus(accent(7));

    @include dark-mode {
      --koi-btn-background-hover: #{accent(8, $alpha: 0.2)};
      --koi-btn-background-active: #{accent(8, $alpha: 0.2)};
      --koi-btn-border-color: #{accent(5)};
      --koi-btn-border-color-hover: #{accent(4)};
      --koi-btn-foreground: #{accent(5)};
      --koi-btn-foreground-hover: #{accent(4)};
      --koi-btn-foreground-active: #{accent(4)};
    }
  }

  @each $color in config.$variant-colors {
    @include variant($color) {
      --koi-btn-background-hover: #{fill($color, 0)};
      --koi-btn-background-active: #{fill($color, 0)};
      --koi-btn-border-color: #{fill($color, 6)};
      --koi-btn-border-color-hover: #{fill($color, 8)};
      --koi-btn-foreground: #{fill($color, 6)};
      --koi-btn-foreground-hover: #{fill($color, 8)};
      --koi-btn-foreground-active: #{fill($color, 8)};

      @include focus(fill($color, 7));

      @include dark-mode {
        --koi-btn-background-hover: #{fill($color, 8, $alpha: 0.2)};
        --koi-btn-background-active: #{fill($color, 8, $alpha: 0.2)};
        --koi-btn-border-color: #{fill($color, 5)};
        --koi-btn-border-color-hover: #{fill($color, 4)};
        --koi-btn-foreground: #{fill($color, 5)};
        --koi-btn-foreground-hover: #{fill($color, 4)};
        --koi-btn-foreground-active: #{fill($color, 4)};
      }
    }
  }
}

@mixin faded {
  --koi-btn-background: #{fill(contrast, 1)};
  --koi-btn-background-hover: #{fill(contrast, 2)};
  --koi-btn-background-active: #{fill(contrast, 2)};
  --koi-btn-border-color: transparent;
  --koi-btn-border-color-hover: transparent;
  --koi-btn-foreground: #{fill(contrast, 8)};
  --koi-btn-foreground-hover: #{fill(contrast, 9)};
  --koi-btn-foreground-active: #{fill(contrast, 9)};

  @include shadow(var(--koi-btn-shadow-hover, shadow(none)));
  @include focus(fill(contrast, 9));

  border-width: var(--koi-btn-border-width, 2px);

  @include hover {
    @include shadow(var(--koi-btn-shadow-hover, shadow(none)));
  }

  @include dark-mode {
    --koi-btn-background: #{fill(contrast, 2)};
    --koi-btn-background-hover: #{fill(contrast, 3, $alpha: 0.5)};
    --koi-btn-background-active: #{fill(contrast, 3, $alpha: 0.5)};
  }

  // Variant colors
  @include variant(accent) {
    --koi-btn-background: #{accent(1)};
    --koi-btn-background-hover: #{accent(2)};
    --koi-btn-background-active: #{accent(2)};
    --koi-btn-foreground: #{accent(8)};
    --koi-btn-foreground-hover: #{accent(9)};
    --koi-btn-foreground-active: #{accent(9)};

    @include focus(accent(7));

    @include dark-mode {
      --koi-btn-background: #{accent(8, $alpha: 0.2)};
      --koi-btn-background-hover: #{accent(7, $alpha: 0.2)};
      --koi-btn-background-active: #{accent(7, $alpha: 0.2)};
      --koi-btn-foreground: #{accent(5)};
      --koi-btn-foreground-hover: #{accent(4)};
      --koi-btn-foreground-active: #{accent(4)};
    }
  }

  @each $color in config.$variant-colors {
    @include variant($color) {
      --koi-btn-background: #{fill($color, 1)};
      --koi-btn-background-hover: #{fill($color, 2)};
      --koi-btn-background-active: #{fill($color, 2)};
      --koi-btn-foreground: #{fill($color, 8)};
      --koi-btn-foreground-hover: #{fill($color, 9)};
      --koi-btn-foreground-active: #{fill($color, 9)};

      @include focus(fill($color, 7));

      @include dark-mode {
        --koi-btn-background: #{fill($color, 8, $alpha: 0.2)};
        --koi-btn-background-hover: #{fill($color, 7, $alpha: 0.2)};
        --koi-btn-background-active: #{fill($color, 7, $alpha: 0.2)};
        --koi-btn-foreground: #{fill($color, 5)};
        --koi-btn-foreground-hover: #{fill($color, 4)};
        --koi-btn-foreground-active: #{fill($color, 4)};
      }
    }
  }
}

@mixin ghost {
  --koi-btn-background: transparent;
  --koi-btn-background-hover: #{fill(contrast, 2)};
  --koi-btn-background-active: #{fill(contrast, 2)};
  --koi-btn-border-color: transparent;
  --koi-btn-border-color-hover: transparent;
  --koi-btn-foreground: #{fill(contrast, 8)};
  --koi-btn-foreground-hover: #{fill(contrast, 9)};
  --koi-btn-foreground-active: #{fill(contrast, 9)};

  @include shadow(var(--koi-btn-shadow-hover, shadow(none)));
  @include focus(fill(contrast, 9));

  border-width: var(--koi-btn-border-width, 2px);

  @include hover {
    @include shadow(var(--koi-btn-shadow-hover, shadow(none)));
  }

  @include dark-mode {
    --koi-btn-background-hover: #{fill(contrast, 3, $alpha: 0.5)};
    --koi-btn-background-active: #{fill(contrast, 3, $alpha: 0.5)};
  }

  // Variant colors
  @include variant(accent) {
    --koi-btn-background-hover: #{accent(2)};
    --koi-btn-background-active: #{accent(2)};
    --koi-btn-foreground: #{accent(8)};
    --koi-btn-foreground-hover: #{accent(9)};
    --koi-btn-foreground-active: #{accent(9)};

    @include focus(accent(7));

    @include dark-mode {
      --koi-btn-background-hover: #{accent(7, $alpha: 0.2)};
      --koi-btn-background-active: #{accent(7, $alpha: 0.2)};
      --koi-btn-foreground: #{accent(5)};
      --koi-btn-foreground-hover: #{accent(4)};
      --koi-btn-foreground-active: #{accent(4)};
    }
  }

  @each $color in config.$variant-colors {
    @include variant($color) {
      --koi-btn-background-hover: #{fill($color, 2)};
      --koi-btn-background-active: #{fill($color, 2)};
      --koi-btn-foreground: #{fill($color, 8)};
      --koi-btn-foreground-hover: #{fill($color, 9)};
      --koi-btn-foreground-active: #{fill($color, 9)};

      @include focus(fill($color, 7));

      @include dark-mode {
        --koi-btn-background-hover: #{fill($color, 7, $alpha: 0.2)};
        --koi-btn-background-active: #{fill($color, 7, $alpha: 0.2)};
        --koi-btn-foreground: #{fill($color, 5)};
        --koi-btn-foreground-hover: #{fill($color, 4)};
        --koi-btn-foreground-active: #{fill($color, 4)};
      }
    }
  }
}

// ---- Modifiers ----

// @mixin compact {
// }

// Makes the button full width
@mixin wide {
  justify-content: center;
  width: 100%;
}

// --------------------------------
//   Styles
// --------------------------------

@mixin styles {
  #{$class},
  a#{$class},
  button,
  [type='button'],
  [type='submit'],
  [type='reset'],
  [type='file'] {
    @include reset;
    @include default;
  }

  #{$selectors} {
    @include default;

    &--solid {
      @include solid;
    }

    &--outline {
      @include outline;
    }

    &--faded {
      @include faded;
    }

    &--ghost {
      @include ghost;
    }

    &--wide {
      @include wide;
    }
  }
}
