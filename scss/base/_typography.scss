// --------------------------------
//   Typography Styles
// --------------------------------

@use 'sass:list';
@use 'sass:math';
@use 'sass:string';

@use '../api' as *;
@use '../helpers' as *;

// --------------------------------
//   Vars
// --------------------------------

$_headings-color: setting(typography, headings-color);
$_headings-font-weight: setting(typography, headings-font-weight);
$_body-font-size: setting(typography, body-font-size);
$_lead-font-size: setting(typography, lead-font-size);

// --------------------------------
//   Functions
// --------------------------------

@function _heading-font-size($heading-level) {
  $headings-font-size: setting(typography, headings-font-size);
  @return list.nth($headings-font-size, $heading-level);
}

// --------------------------------
//   Mixins
// --------------------------------

// Add spacing to heading when inside a prose parent
@mixin _heading-prose-spacing($heading-level, $margin-top: true, $margin-bottom: true) {
  $spacing-ratio: setting(typography, headings-spacing-ratio);
  $font-size-key: _heading-font-size($heading-level);
  $font-size-rem: font-size($font-size-key);
  $font-size-px: rem-to-px($font-size-rem);

  @if $margin-top {
    margin-top: em($font-size-px * $spacing-ratio, $font-size-px);
  } @else {
    margin-top: 0;
  }

  @if $margin-bottom {
    margin-bottom: em(math.div($font-size-px * $spacing-ratio, 2), $font-size-px);
  } @else {
    margin-bottom: 0;
  }

  line-height: text-leading($font-size-key);
}

@mixin base {
  @if setting(typography, use-hyphens) {
    p,
    li,
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      hyphens: auto;
      overflow-wrap: break-word;
    }

    // Lead paragraphs, etc.
    .lead {
      @include text-size($_lead-font-size);
    }

    // TODO: Include instead of text-size fluid typography? Should we use responsive-font size / fluid?
    // Prose typography
    .prose {
      @include text-size($_body-font-size);

      p {
        margin-bottom: 1.25em;
        margin-top: 1.25em;
      }
    }
  }
}

@mixin headings {
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    color: fill($_headings-color);
    font-family: font(headings);
    font-weight: font-weight($_headings-font-weight);
  }

  h1,
  .h1 {
    $font-size: _heading-font-size(1);
    font-size: font-size($font-size);
  }

  h2,
  .h2 {
    $font-size: _heading-font-size(2);
    font-size: font-size($font-size);
  }

  h3,
  .h3 {
    $font-size: _heading-font-size(3);
    font-size: font-size($font-size);
  }

  h4,
  .h4 {
    $font-size: _heading-font-size(4);
    font-size: font-size($font-size);
  }

  h5,
  .h5 {
    $font-size: _heading-font-size(5);
    font-size: font-size($font-size);
  }

  h6,
  .h6 {
    $font-size: _heading-font-size(6);
    font-size: font-size($font-size);
  }

  // Prose typography
  .prose {
    h1,
    .h1 {
      @include _heading-prose-spacing(1, $margin-top: false);
    }

    h2,
    .h2 {
      @include _heading-prose-spacing(2);
    }

    h3,
    .h3 {
      @include _heading-prose-spacing(3);
    }

    h4,
    .h4 {
      @include _heading-prose-spacing(4);
    }

    h5,
    .h5 {
      @include _heading-prose-spacing(5);
    }

    h6,
    .h6 {
      @include _heading-prose-spacing(6);
    }
  }
}

@mixin lists {
  // Prose typography
  .prose {
    ul,
    ol {
      margin: spacing(md, 0, md, md);
      padding-left: spacing(sm);

      li {
        list-style-position: inside;

        &::marker {
          color: accent(6);
        }
      }
    }
  }
}

// --------------------------------
//   Styles
// --------------------------------

@mixin styles {
  @include base;
  @include headings;
  @include lists;
}
